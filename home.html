<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>NormandX</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <div class="logo" onclick="location.href='home.html'">
    <span>Normand</span><span>X</span>
  </div>
  <input class="search" placeholder="Rechercher..." oninput="search(this.value)">
  <div class="account" onclick="toggleMenu()">
    <img src="account.png">
  </div>
</header>

<div class="menu" id="menu">
  <a href="account.html">Compte</a>
  <a href="favorites.html">Favoris</a>
  <a href="history.html">Historique</a>
  <a onclick="logout()">D√©connexion</a>
</div>

<div class="layout">
<aside id="categories"></aside>

<main>
  <div class="grid" id="grid"></div>
</main>
</div>

<script>
const user = localStorage.getItem("connected");
if(!user) location.href="auth.html";

const categories = [
 "Hetero","MILF","Teen","Anal","Lesbian","Gays",
 "Amateur","Asian","BBW","Fetish","Hardcore","Compilation","Vintage"
];

const videos = [
 {
  id:1,
  t:"Carla Cute 1",
  c:"Hetero",
  poster:"thumbs/1.jpg",
  v:"https://ia601703.us.archive.org/22/items/video-1_20260114/Video1.mp4",
  d:"12:34",
  hd:true,
  views:0
 }
];

const grid = document.getElementById("grid");
const catBox = document.getElementById("categories");

categories.forEach(c=>{
 catBox.innerHTML+=`<a onclick="filter('${c}')">${c}</a>`;
});

function render(list){
 grid.innerHTML="";
 list.forEach(v=>{
  grid.innerHTML+=`
  <div class="card">
   <div class="thumb"
    onmouseenter="previewStart(this)"
    onmouseleave="previewStop(this)"
    ontouchstart="mobilePreview(this)">
    <video muted playsinline preload="metadata" poster="${v.poster}">
     <source src="${v.v}" type="video/mp4">
    </video>
    ${v.hd?'<span class="badge">HD</span>':''}
    <span class="duration">${v.d}</span>
    <div class="progress"><div></div></div>
   </div>

   <div class="info" onclick="openVideo(${v.id})">
    <p>${v.t}</p>
    <div class="meta">
     <span>${v.views} vues</span>
     <span>${v.c}</span>
    </div>
   </div>

   <div class="actions">
    <button onclick="like(${v.id},event)">üëç</button>
    <button onclick="fav(${v.id},event)">‚ù§</button>
   </div>
  </div>`;
 });
}

render(videos);

/* PREVIEW */
let hoverTimer;
function previewStart(el){
 const v=el.querySelector("video");
 const b=el.querySelector(".progress div");
 hoverTimer=setTimeout(()=>{
  v.currentTime=0;v.play();
  v.ontimeupdate=()=>b.style.width=(v.currentTime/v.duration*100)+"%";
 },300);
}
function previewStop(el){
 clearTimeout(hoverTimer);
 const v=el.querySelector("video");
 v.pause();v.currentTime=0;
 el.querySelector(".progress div").style.width="0%";
}

/* MOBILE LONG TAP */
let mobileTimer;
function mobilePreview(el){
 if(window.innerWidth>900) return;
 mobileTimer=setTimeout(()=>previewStart(el),400);
 document.addEventListener("touchend",()=>{
  clearTimeout(mobileTimer);
  previewStop(el);
 },{once:true});
}

/* ACTIONS */
function openVideo(id){
 let h=JSON.parse(localStorage.getItem("history")||"[]");
 if(!h.includes(id)) h.push(id);
 localStorage.setItem("history",JSON.stringify(h));
 location.href="video.html?id="+id;
}
function like(id,e){
 e.stopPropagation();
 let l=JSON.parse(localStorage.getItem("likes")||"[]");
 if(!l.includes(id)) l.push(id);
 localStorage.setItem("likes",JSON.stringify(l));
}
function fav(id,e){
 e.stopPropagation();
 let f=JSON.parse(localStorage.getItem("favorites")||"[]");
 if(!f.includes(id)) f.push(id);
 localStorage.setItem("favorites",JSON.stringify(f));
}

function search(q){
 render(videos.filter(v=>v.t.toLowerCase().includes(q.toLowerCase())));
}
function filter(c){
 render(videos.filter(v=>v.c===c));
}
function toggleMenu(){
 menu.style.display=menu.style.display==="block"?"none":"block";
}
function logout(){
 localStorage.clear();
 location.href="auth.html";
}
</script>

</body>
</html>