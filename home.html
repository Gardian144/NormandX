<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>NormandX</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>

<body>

<header>
  <div class="logo" onclick="location.href='home.html'">
    <span>Normand</span><span>X</span>
  </div>

  <input class="search" placeholder="Rechercher..." oninput="search(this.value)">

  <div class="account" onclick="toggleMenu()">
    <img src="account.png">
  </div>
</header>

<div class="menu" id="menu">
  <a href="favorites.html">â¤ï¸ Favoris</a>
  <a href="history.html">ğŸ“ Historique</a>
  <a onclick="logout()">ğŸšª DÃ©connexion</a>
</div>

<div class="layout">
<aside>
  <a onclick="filter('Hetero')">HÃ©tÃ©ro</a>
  <a onclick="filter('MILF')">MILF</a>
  <a onclick="filter('Teen')">Teen</a>
</aside>

<main>
  <div class="grid" id="grid"></div>
</main>
</div>

<script>
/* USER */
let user = localStorage.getItem("connected") || "guest";
localStorage.setItem("connected", user);

/* MENU */
function toggleMenu(){
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}
document.addEventListener("click",e=>{
  if(!e.target.closest(".account")) menu.style.display="none";
});
function logout(){
  localStorage.removeItem("connected");
  location.reload();
}

/* DATA */
const videos=[
 {
  id:1,
  t:"Carla Cute 1",
  c:"Hetero",
  poster:"https://via.placeholder.com/640x360/000000/ffffff?text=Preview",
  v:"https://ia601703.us.archive.org/22/items/video-1_20260114/Video1.mp4",
  d:"12:34",
  views:0
 },
 {
  id:2,
  t:"Ma cousine m'a fait perdre le NNN",
  c:"Hetero",
  poster:"https://via.placeholder.com/640x360/000000/ffffff?text=Preview",
  v:"https://ia601402.us.archive.org/0/items/xnxx-incroyable-blonde-bien-roulee-percee-par-filoufitt-360p/XNXX_incroyable_blonde_bien_roulee-percee-par-filoufitt_360p.mp4",
  d:"18:05",
  views:0
 }
];
localStorage.setItem("videos",JSON.stringify(videos));

let favorites=JSON.parse(localStorage.getItem("fav_"+user)||"[]");
const grid=document.getElementById("grid");

/* RENDER */
function render(list){
  grid.innerHTML="";
  list.forEach(v=>{
    const card=document.createElement("div");
    card.className="card";
    card.onclick=()=>location.href="video.html?id="+v.id;

    card.innerHTML=`
      <div class="thumb">
        <img src="${v.poster}">
        <video muted playsinline preload="metadata">
          <source src="${v.v}" type="video/mp4">
        </video>
        <span class="duration">${v.d}</span>
      </div>

      <p>${v.t}</p>
    `;
    grid.appendChild(card);
  });

  initPreviews();
}

/* PREVIEW LOGIC â€“ FIX DÃ‰FINITIF */
function initPreviews(){
  document.querySelectorAll(".thumb").forEach(thumb=>{
    const video=thumb.querySelector("video");
    const img=thumb.querySelector("img");

    /* PC */
    thumb.addEventListener("mouseenter",()=>{
      if(innerWidth<900) return;
      video.load();
      video.currentTime=0.05;
      video.play();
      video.style.opacity=1;
      img.style.opacity=0;
    });

    thumb.addEventListener("mouseleave",()=>{
      video.pause();
      video.style.opacity=0;
      img.style.opacity=1;
    });

    /* MOBILE */
    thumb.addEventListener("touchstart",e=>{
      e.preventDefault();
      video.load();
      video.currentTime=0.05;
      video.play();
      video.style.opacity=1;
      img.style.opacity=0;
    });

    thumb.addEventListener("touchend",()=>{
      video.pause();
      video.style.opacity=0;
      img.style.opacity=1;
    });
  });
}

/* SEARCH / FILTER */
function search(q){
  render(videos.filter(v=>v.t.toLowerCase().includes(q.toLowerCase())));
}
function filter(c){
  render(videos.filter(v=>v.c===c));
}

render(videos);
</script>

</body>
</html>